<html>
<script src='https://d3js.org/d3.v5.min.js'></script>


<style> 
  .tooltiptext{font-family: Arial; font-size: 15}
  .legendtxt{font-family: Arial; font-size: 15}
  .axistxt{font-family: Arial; font-size: 15}
  .titletxt{font-family: Arial; font-weight:bold; font-size: 20}


</style>

<body onload='init()'>

<button onclick="document.location='index.html'">index</button>

<script>
  var width = "900";
  var height = "600";
  d3.select("body").append("svg").attr("width", width).attr("height", height)  
  .attr("style", 
    "border:solid; border-color:grey; border-width:2px; background-color:rgb(240,240,240)");

async function init() {
  var data01 = await d3.csv("https://raw.githubusercontent.com/steve303/mywebpage/master/data/employment.csv");
  console.log(data01);

  //transform data01 wrt to "country name" => data02 
  var data02 = d3.nest().key(d => d['Country Name']).entries(data01);
  console.log(data02);

  var countryName = data02.map(d => d.key);
  //var color = d3.scaleOrdinal().domain(countryName).range(d3.schemePaired);
  var color = d3.scaleOrdinal().domain(countryName)
  .range(["gold", "lightgrey", "green", "grey", "black", "red", "violet", "pink", "brown", "blue", "purple", "orange","skyblue"]);
  var yaxisTitle = "% of Adult Population Employed"
  var chartTitle = "Chart Title"
  var marginX = width * 0.10;
  var marginY = height * 0.10;
  var widthX = width - 3.5*marginX;
  var widthY = height - 2*marginY;
  var originX = marginX;
  var originY = marginY;
  var originY01 = widthY+marginY
  var origin00 = "translate(" + originX + "," + originY + ")";
  var origin01 = "translate(" + originX + "," + originY01 +  ")";
  var buffer = 18; //controls legend rect spacing 
  //legend parameters
  var rectWidth = 10;
  var rectHeight = 10;

  var max_X = d3.max(data01, function(d) { return +d['Measure Names']; });  //alternate way without map()
  var min_X = d3.min(data01, function(d) { return +d['Measure Names']; });
  var max_Y = d3.max(data01, function(d) { return +d['Measure Values']; });  //alternate way without map()
  var min_Y = d3.min(data01, function(d) { return +d['Measure Values']; });
  //console.log(max_Y + ' ' + min_Y);
  //console.log(max_X + ' ' + min_X);
  var xscale = d3.scaleLinear().domain([2000, 2020]).range([0,widthX]);
  var yscale = d3.scaleLinear().domain([100, 0]).range([0,widthY]);
  //create the object, lineGen, which creates the path input
  var lineGen = d3.line()
  .x((d) => xscale(d['Measure Names']))
  .y((d) => yscale(d['Measure Values']));

//append path
  d3.select("body").select("svg")

  .append("g").attr("transform", origin00 )
  .selectAll("path")
  .data(data02)
  .enter()
  .append("path")
  .attr("d", function (d) {return lineGen(d.values);})
  .attr("fill", "none")
  .attr("stroke", d => color(d.key))
  .attr("stroke-width", 2);
  
//append yaxis 
  d3.select("body").select("svg")
  .append("g")
  .attr("class", "axistxt")
  .attr("transform", origin00)
  .call(d3.axisLeft(yscale).tickValues([0,25,50,75,100]).tickFormat((d,i)=>["0","25","50","75","100"][i]))
  .append("text")
  .attr("transform", "rotate(-90)")
  .attr("x", -widthY/4 )
  .attr("y", -marginY/2)
  .attr("fill", "black").attr("font-weight", "bold")
  .text(yaxisTitle);

//append xaxis 
  d3.select("body").select("svg")
  .append("g")
  .attr("class", "axistxt")
  .attr("transform", origin01)
  .call(d3.axisBottom(xscale).tickValues([2000,2005,2010,2015,2020]).tickFormat((d,i)=>["2000","2005","2010","2015","2020"][i]))
  .append("text")
  .attr("x", widthX/2 )
  .attr("y", marginY/1.5)
  .attr("fill", "black").attr("font-weight", "bold")
  .text("Year");

//append circles
  d3.select("body").select("svg")
    .append("g").attr("transform", origin00 )
    .selectAll("circle")
    .data(data01)
    .enter()
    .append("circle")
    .on("mouseover", onMouseOver) //Add listener for the mouseover event
    .on("mouseout", onMouseOut)   //Add listener for the mouseout event
    .attr("r", rectWidth/4)
    .attr("cx", d => xscale(d["Measure Names"]))
    .attr("cy", d => yscale(d["Measure Values"]))
    .style("fill", d => color(d["Country Name"]));

//mouseover event handler function
    function onMouseOver(d, i) {
        //d3.select(this).attr('class', 'highlight');
        var x = d["Measure Names"]
        var y = d["Measure Values"]
        d3.select(this)
          .transition()     // adds animation
          .duration(200)
          .attr('r', rectWidth/2);
          
        d3.select("body").select("svg")
        .append("g").attr("transform", origin00)
        .append("text")
        .attr("class", "tooltiptext") 
        .attr("x", d => xscale(x))
        .attr("y", d => yscale(y))
        .text(function() {
             return [ ' ' +d["Country Name"] + " " + d["Measure Values"] ]; } );
    }

//mouseout event handler function
    function onMouseOut(d, i) {
        d3.select(this)
          .transition()     
          .duration(200)
          .attr("r", rectWidth/4);
      
        d3.selectAll('.tooltiptext')  //select class .tooltiptext for easy removal 
          .remove()
    }

//append legends
  d3.select("body").select("svg")
    .append("g").attr("transform", origin00)
    .selectAll("rect")
    .data(data02)
    .enter()
    .append("rect")
    .attr("x", widthX + 2*buffer)
    .attr("y", function(d,i) {return i*buffer + marginY;})
    .attr("width", rectWidth)
    .attr("height", rectHeight)
    .style("fill", d => color(d.key));

  d3.select("body").select("svg")
    .append("g").attr("transform", origin00)
    .selectAll("text")
    .data(data02)
    .enter()
    .append("text")
    .attr("class", "legendtxt")
    .attr("x", widthX + 3*buffer)
    .attr("y", function(d,i) {return i*buffer+rectWidth + marginY;})
    .text(d => d.key);

  d3.select("body").select("svg")
    .append("text")
    .attr("class", "titletxt")
    .attr("x", marginX + widthX/2)
    .attr("y", marginY/2)
    .text(chartTitle);  
           
}


</script>
</body>


</html>


